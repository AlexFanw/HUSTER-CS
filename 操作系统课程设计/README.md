# æ“ä½œç³»ç»Ÿè¯¾ç¨‹è®¾è®¡ğŸ”§

## ä¸€.ç›®çš„

- æŒæ¡Linuxæ“ä½œç³»ç»Ÿçš„ä½¿ç”¨æ–¹æ³•
- äº†è§£Linuxç³»ç»Ÿå†…æ ¸ä»£ç ç»“æ„
- æŒæ¡å®ä¾‹æ“ä½œç³»ç»Ÿçš„å®ç°æ–¹æ³•

## äºŒ.è®¾è®¡å†…å®¹

1. Linuxç”¨æˆ·ç•Œé¢çš„ä½¿ç”¨

> * ç¼–ä¸€ä¸ªCç¨‹åºï¼Œå…¶å†…å®¹ä¸ºå®ç°æ–‡ä»¶æ‹·è´çš„åŠŸèƒ½.
>
> - [x] åŸºæœ¬è¦æ±‚:ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨*open/read/write...*; é€‰æ‹©:å®¹é”™ã€*cp*ã€‚
>
> * ç¼–ä¸€ä¸ªCç¨‹åºï¼Œå…¶å†…å®¹ä¸ºåˆ†çª—å£åŒæ—¶æ˜¾ç¤ºä¸‰ä¸ªå¹¶å‘è¿›ç¨‹çš„è¿è¡Œç»“æœã€‚è¦æ±‚ç”¨åˆ°Linuxä¸‹çš„å›¾å½¢åº“ã€‚ (gtk/Qt) 
>
> - [x] åŸºæœ¬è¦æ±‚:ä¸‰ä¸ªç‹¬ç«‹å­è¿›ç¨‹å„è‡ªçª—å£æ˜¾ç¤º;é€‰æ‹©:ä¸‰ä¸ªè¿›ç¨‹èªŠæŠ„æ¼”ç¤ºã€‚

2. æŒæ¡ç³»ç»Ÿè°ƒç”¨çš„å®ç°è¿‡ç¨‹ï¼Œé€šè¿‡ç¼–è¯‘å†…æ ¸æ–¹æ³•ï¼Œå¢åŠ ä¸€ä¸ªæ–°çš„ç³»ç»Ÿè°ƒç”¨ã€‚å¦ç¼–å†™ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œä½¿ç”¨æ–°å¢åŠ çš„ç³»ç»Ÿè°ƒç”¨ã€‚

> * å†…æ ¸ç¼–è¯‘ã€ç”Ÿæˆ,ç”¨æ–°å†…æ ¸å¯åŠ¨;
> * æ–°å¢ç³»ç»Ÿè°ƒç”¨å®ç°:æ–‡ä»¶æ‹·è´æˆ–Pã€Væ“ä½œã€‚

3. æŒæ¡å¢åŠ è®¾å¤‡é©±åŠ¨ç¨‹åºçš„æ–¹æ³•ã€‚é€šè¿‡æ¨¡å—æ–¹æ³•ï¼Œå¢åŠ ä¸€ä¸ªæ–°çš„å­—ç¬¦è®¾å¤‡é©±åŠ¨ç¨‹åºï¼Œå…¶åŠŸèƒ½å¯ä»¥ç®€å•,åŸºäºå†…æ ¸ç¼“å†²åŒºã€‚

> - [x] åŸºæœ¬è¦æ±‚:æ¼”ç¤ºå®ç°å­—ç¬¦è®¾å¤‡è¯»ã€å†™;
> - [x] é€‰æ‹©:é”®ç›˜ç¼“å†²åŒºï¼Œä¸åŒè¿›ç¨‹ã€è¿½åŠ ã€è¯»å–ã€‚

4. ä½¿ç”¨GTK/QTå®ç°ç³»ç»Ÿç›‘æ§å™¨

> * äº†è§£/procæ–‡ä»¶çš„ç‰¹ç‚¹å’Œä½¿ç”¨æ–¹æ³•
> * ç›‘æ§ç³»ç»Ÿä¸­è¿›ç¨‹è¿è¡Œæƒ…å†µ
> * ç”¨å›¾å½¢ç•Œé¢å®ç°ç³»ç»Ÿèµ„æºçš„ç›‘æ§

5. è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ¨¡æ‹Ÿçš„æ–‡ä»¶ç³»ç»Ÿ

> * åŸºäºä¸€å¤§æ–‡ä»¶(10Mæˆ–100M)ï¼Œæ¨¡æ‹Ÿç£ç›˜;
> * æ ¼å¼åŒ–ï¼Œå»ºç«‹æ–‡ä»¶ç³»ç»Ÿç®¡ç†æ•°æ®ç»“æ„; 
> * åŸºæœ¬æ“ä½œï¼Œå®ç°æ–‡ä»¶ã€ç›®å½•ç›¸å…³æ“ä½œã€‚



## ä¸‰.å®éªŒç¯å¢ƒ

- Windows10 +è™šæ‹ŸæœºUbuntu19.10 (60G)+å†…æ ¸Linux 5.4.21

## å››.å®éªŒæ­¥éª¤

### 4.1 Linuxç”¨æˆ·ç•Œé¢çš„ä½¿ç”¨

**1.é…ç½®è™šæ‹Ÿæœº**
[Vmwareå®‰è£…è™šæ‹ŸæœºUbuntuçŸ¥ä¹æ•™ç¨‹é“¾æ¥ğŸ”—](https://zhuanlan.zhihu.com/p/38797088)
[VMwareè™šæ‹Ÿæœºæ‰©å±•Ubuntuç³»ç»Ÿç£ç›˜ç©ºé—´æ•™ç¨‹ğŸ”—](https://blog.csdn.net/daemon_2017/article/details/80660372)
å…¶ä»–å…·ä½“æ•™ç¨‹å°±æŒ‰ç…§ä¸ªäººéœ€æ±‚Googleå°±å¥½å’¯. 

**2.(task1)ç¼–å†™Get_Copy_Getæ–‡ä»¶èªŠæŠ„ç¨‹åº**
è¿™æ˜¯ä¸€ä¸ªæ ·ä¾‹,ä¸æ¶‰åŠå¹¶å‘.

```C++
#include <unistd.h>
#include <fcntl.h>
#include <stdio.h>
#include <sys/types.h> 
#include <sys/stat.h> 
#include <errno.h>
#include <string.h>
#define BUFFER_SIZE 1024 
int main(int argc,char **argv) {
//ç¼“å†²åŒºå¤§å°
    int from_fd,to_fd;
    int bytes_read,bytes_write;
    char buffer[BUFFER_SIZE];
    char *ptr;
    if(argc!=3) //ä¸‰ä¸ªå‚æ•°
    {
    fprintf(stderr,"Usage:%s fromfile tofile\n\a",argv[0]);
    return(-1);
    }
    /* æ‰“å¼€æºæ–‡ä»¶ */
    if((from_fd=open(argv[1],O_RDONLY))==-1)
    {
        fprintf(stderr,"Open %s Error:%s\n",argv[1],strerror(errno));
        return(-1);
    }
/* åˆ›å»ºç›®çš„æ–‡ä»¶ */ 
    if((to_fd=open(argv[2],O_WRONLY|O_CREAT,S_IRUSR|S_IWUSR))==-1) {
        fprintf(stderr,"Open %s Error:%s\n",argv[2],strerror(errno));
        //è®¾å®šä¸€ä¸ªç¼“å†²åŒº
        return(-1); 
    }
/* ä»¥ä¸‹ä»£ç æ˜¯ä¸€ä¸ªç»å…¸çš„æ‹·è´æ–‡ä»¶çš„ä»£ç  */ 
    while(bytes_read=read(from_fd,buffer,BUFFER_SIZE)) {
/* ä¸€ä¸ªè‡´å‘½çš„é”™è¯¯å‘ç”Ÿäº† */ 
        if((bytes_read==-1)&&(errno!=EINTR)) break;
        else if(bytes_read>0)
        {
            ptr=buffer; 
            while(bytes_write=write(to_fd,ptr,bytes_read))
            {
/* ä¸€ä¸ªè‡´å‘½é”™è¯¯å‘ç”Ÿäº† */ 
            if((bytes_write==-1)&&(errno!=EINTR))break;
        /* å†™å®Œäº†æ‰€æœ‰è¯»çš„å­—èŠ‚ */
            else if(bytes_write==bytes_read) break;
        /* åªå†™äº†ä¸€éƒ¨åˆ†,ç»§ç»­å†™ */
            else if(bytes_write>0)
            {
                ptr+=bytes_write;
                bytes_read-=bytes_write;
            }
        }
/* å†™çš„æ—¶å€™å‘ç”Ÿçš„è‡´å‘½é”™è¯¯ */ if(bytes_write==-1)break;
        }
        }
        close(from_fd);
        close(to_fd);

        return(1); 
    }
```

**3.(task2)ç¼–ä¸€ä¸ªCç¨‹åºï¼Œå…¶å†…å®¹ä¸ºåˆ†çª—å£åŒæ—¶æ˜¾ç¤ºä¸‰ä¸ªå¹¶å‘è¿›ç¨‹çš„è¿è¡Œç»“æœã€‚è¦æ±‚ç”¨åˆ°Linuxä¸‹çš„å›¾å½¢åº“ã€‚ (gtk/Qt) **
å› ä¸ºGTKä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡,è€Œä¸”æœ‰ä¸€ç‚¹ç‚¹å¤è€,æ‰€ä»¥æˆ‘é€‰æ‹©äº†Qt5.
æˆ‘ä¸€å…±åšäº†å››ä¸ªå¹¶å‘è¿›ç¨‹,é€šè¿‡fork()æ¥å®ç°.åˆ†åˆ«ç›‘è§†ç³»ç»Ÿä¸–ç•Œã€CPUä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ã€ç£ç›˜ä½¿ç”¨ç‡.

![F803A68E974232A903522C7D7E91BA06](http://alexfanblog.oss-cn-beijing.aliyuncs.com/2020/02/29/f803a68e974232a903522c7d7e91ba06.jpg?image/auto-orient,1/interlace,1/quality,q_100)
(æºç æ”¾åœ¨äº†Githubä»“åº“é‡Œé¢,æ¬¢è¿å¤§å®¶ä¸€èµ·å­¦ä¹ äº¤æµ)

### 4.2æ–°å¢ç³»ç»Ÿè°ƒç”¨å®ç°

**ä»¥ä¸‹å†…å®¹åŸºäºUbuntu19.10 + å†…æ ¸Linux5.4.21,å¦‚æœæ˜¯4.x.xç‰ˆæœ¬çš„å†…æ ¸,å‚è€ƒä»¥ä¸‹ä¸‹æ–‡é“¾æ¥**
ğŸ‘‰[åŸºäºLinux4ä»£å†…æ ¸çš„æ–°å¢ç³»ç»Ÿè°ƒç”¨æ­¥éª¤](https://blog.csdn.net/qq_41175905/article/details/80529245)

**1.é…ç½®è™šæ‹Ÿæœº**
[Vmwareå®‰è£…è™šæ‹ŸæœºUbuntuçŸ¥ä¹æ•™ç¨‹é“¾æ¥ğŸ”—](https://zhuanlan.zhihu.com/p/38797088)
[VMwareè™šæ‹Ÿæœºæ‰©å±•Ubuntuç³»ç»Ÿç£ç›˜ç©ºé—´æ•™ç¨‹ğŸ”—](https://blog.csdn.net/daemon_2017/article/details/80660372)



**2.æ›´æ¢Ubuntuæºä¸ºæ¸…åæº**
[æ›´æ¢é•œåƒæºé“¾æ¥ğŸ”—](https://blog.csdn.net/yumei1998/article/details/83214433)
æ³¨æ„ä½ çš„Ubuntuç‰ˆæœ¬,é€‰æ‹©é€‚é…çš„é•œåƒæº,å¯åŠ å¿«å®‰è£…åŒ…çš„é€Ÿåº¦.



**3.ä¸€é”®é…ç½®æ‰€æœ‰æ‰€éœ€è¦çš„åŒ…**
æ¢å¥½é•œåƒæºåç›´æ¥åœ¨å‘½ä»¤è¡Œé‡Œé…ç½®å°±è¡Œäº†.

```
apt-get install libncurses-dev flex bison openssl libssl-dev dkms libelf-dev libudev-dev libpci-dev libiberty-dev autoconf
```

åç»­å¦‚æœç¼ºå…¶ä»–åŒ…å°±å®‰è£…ç³»ç»Ÿæç¤ºä¸‹è½½å°±å¥½äº†



**4.å†…æ ¸ä¸‹è½½**
åˆ«å»www.kernel.orgä¸‹äº†,é€Ÿåº¦å®åœ¨ä¸å¿ç›´è§†
ç›´æ¥é€šè¿‡ä¸‹è¿°é“¾æ¥ä¸‹è½½é…ç½®.
[kernelé•œåƒæºé“¾æ¥ğŸ”—](http://ftp.sjtu.edu.cn/sites/ftp.kernel.org/pub/linux/kernel/)
é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬æŒ‘ä¸€ä¸ªä¸‹è½½å³å¯.



**5.å®‰è£…å†…æ ¸**

- ctrl+alt+tå¿«é€Ÿæ‰“å¼€CMD,å¹¶ä¸”è¾“å…¥sudo suè·å¾—ç®¡ç†å‘˜æƒé™.
- å°†ä¸‹è½½å¥½çš„å†…æ ¸moveåˆ°/usr/srcç›®å½•ä¸‹,ä½¿ç”¨å‘½ä»¤

```
sudo mv **/**/**/linux***  /usr/src/
//**ä»£è¡¨ä½ åˆšä¸‹è½½çš„linuxå†…æ ¸çš„è·¯å¾„
```

- è¿›å…¥/usr/src/ è§£å‹æ–‡ä»¶

```
sudo tar -xvf  linux****
//linux***ä»£è¡¨ä½ åˆšä¸‹è½½çš„linuxå†…æ ¸çš„æ–‡ä»¶å,å¯ä»¥ç”¨tabè‡ªåŠ¨è¡¥é½.
```

- è¿›å…¥è§£å‹å‡ºæ¥çš„å†…æ ¸æ–‡ä»¶ä¸­çš„kernelç›®å½•

```
cd linux***/kernel
```

- ä¿®æ”¹sys.cæ–‡ä»¶

```
sudo gedit sys.c
//åœ¨æœ€æœ«å°¾åŠ ä¸Šä½ æƒ³åŠ çš„æ–°çš„ç³»ç»Ÿè°ƒç”¨
//ä¸¾ä¸ªä¾‹å­,helloworldç¨‹åº
SYSCALL_DEFINE1(helloworld,int,number){
        printk("Hello,world!");
        return number+1
}
//å¯¹ç³»ç»Ÿè°ƒç”¨çš„ç¼–å†™ æ³¨æ„æ­¤å¤„ä¸å‰ç‰ˆæœ¬å†…æ ¸çš„ä¸åŒ
//ä¸Šè¿°ç¨‹åºä¸­,1ä»£è¡¨è¿™ä¸ªå‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°,æœ‰ä¸¤ä¸ªå‚æ•°å°±æ¢æˆ2
//helloworldæ˜¯æ–°å¢ç³»ç»Ÿè°ƒç”¨å‡½æ•°å
//intæ˜¯å‚æ•°ç±»å‹,numberæ˜¯å½¢å‚.
//å‡½æ•°åŠŸèƒ½å°±æ˜¯æ‰“å°Hello,world!,å¹¶ä¸”è¿”å›1+number.å¯ä»¥é€šè¿‡dmesgçœ‹åˆ°æ‰“å°çš„å¥å­.
```

- å¢åŠ ç³»ç»Ÿè°ƒç”¨å·

```
//ä»kernelè¿”å›ä¸Šä¸€çº§ç›®å½•
cd /arch/x86/entry/syscalls
sudo gedit syscall_64.tbl
//å¢åŠ ä¸€ä¸ªæ–°çš„ç³»ç»Ÿè°ƒç”¨
//ä¾‹å¦‚ 335    64  helloworld      __x64_sys_helloworld
```

- å¢åŠ ç³»ç»Ÿè°ƒç”¨å¤´æ–‡ä»¶

```
//è¿”å›/usr/src/linux***ç›®å½•
cd include/linux
sudo gedit syscalls.h
//ä¾‹å¦‚asmlinkage long sys_helloworld(int number);
```

- æœ€åæŒ‰ç…§ä¸Šè¿°æ­¥éª¤ç¼–å†™ä½ çš„æ–‡ä»¶copyå’ŒPã€Væ“ä½œç³»ç»Ÿè°ƒç”¨ç¨‹åºå§



**6.ç¼–è¯‘å†…æ ¸**

```
sudo make mrproper //åˆ é™¤ä¹‹å‰ç¼–è¯‘çš„æ®‹ä½™æ–‡ä»¶.åªåœ¨ç¬¬ä¸€æ¬¡ç¼–è¯‘æ—¶æ‰§è¡Œå³å¯,ä»¥å…æ¯æ¬¡ç¼–è¯‘æŠŠé‡å¤æ–‡ä»¶é‡å¤ç¼–è¯‘.
sudo make clean //å¯æ‰§è¡Œå¯ä¸æ‰§è¡Œ,å› ä¸ºä¸Šä¸€ä¸ªå‘½ä»¤ä¼¼ä¹æ˜¯æ¶µç›–äº†cleançš„
sudo make menuconfig//åœ¨general setupå“ªé‡Œç»™ä½ çš„å†…æ ¸æ¢ä¸ªåå­—,æ¯”å¦‚AlexKernel
sudo make -j4 //æ ¹æ®ä½ ç»™è™šæ‹Ÿæœºåˆ†é…çš„æ ¸å¿ƒæ•°æ¥é€‚é….æˆ‘åˆ†äº†4æ ¸å¿ƒ.
sudo make modules_install // å®‰è£…å†…æ ¸æ¨¡å—
sudo make install //å®‰è£…å†…æ ¸
```

**7.æ›´æ¢ç³»ç»Ÿé»˜è®¤å¯åŠ¨å†…æ ¸**
[æ›´æ¢å¯åŠ¨å†…æ ¸é“¾æ¥ğŸ”—](https://blog.csdn.net/cf_wu95/article/details/85984956)



**8.é‡å¯,ç¼–å†™ä½ çš„æµ‹è¯•cæ–‡ä»¶.**

(PS:ä¸å«Œéº»çƒ¦çš„å¯ä»¥ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚[æ–°å¢ç³»ç»Ÿè°ƒç”¨å®˜æ–¹æ–‡æ¡£ğŸ”—](https://www.kernel.org/doc/html/latest/process/adding-syscalls.html))


### 4.3å¢åŠ è®¾å¤‡é©±åŠ¨ç¨‹åº

[è®¾å¤‡é©±åŠ¨ç¨‹åºç¼–å†™å®˜æ–¹æ•™ç¨‹é“¾æ¥ğŸ”—](https://www.tldp.org/LDP/lkmpg/2.4/html/c577.htm)
[æ¨èç›¸å…³åšå®¢æ•™ç¨‹ğŸ”—](https://www.cnblogs.com/lidabo/p/5312827.html)

> å»ºè®®çœ‹çœ‹æˆ‘GitHubä¸­çš„æ“ä½œç³»ç»Ÿè¯¾ç¨‹è®¾è®¡æŒ‡å¯¼ä¹¦ğŸ“–.é‡Œé¢å…³äºè®¾å¤‡é©±åŠ¨ç¨‹åºæœ‰å¾ˆè¯¦ç»†çš„ä¾‹å­.

ç³»ç»Ÿè°ƒç”¨æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸å’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„æ¥å£ï¼Œè®¾å¤‡é©±åŠ¨ç¨‹åºæ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸å’Œæœºå™¨ç¡¬ä»¶ä¹‹é—´çš„æ¥å£ã€‚è®¾å¤‡é©±åŠ¨ç¨‹åºä¸ºåº”ç”¨ç¨‹åºå±è”½äº†ç¡¬ä»¶çš„ç»†èŠ‚ï¼Œè¿™æ ·åœ¨åº”ç”¨ç¨‹åºçœ‹æ¥ï¼Œç¡¬ä»¶è®¾å¤‡åªæ˜¯ä¸€ä¸ªè®¾å¤‡æ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥è±¡æ“ä½œæ™®é€šæ–‡ä»¶ä¸€æ ·å¯¹ç¡¬ä»¶è®¾å¤‡è¿›è¡Œæ“ä½œã€‚è®¾å¤‡é©±åŠ¨ç¨‹åºæ˜¯å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå®Œæˆä»¥ä¸‹çš„åŠŸèƒ½:

  ã€€ã€€1. å¯¹è®¾å¤‡åˆå§‹åŒ–å’Œé‡Šæ”¾ã€‚
  ã€€ã€€2. æŠŠæ•°æ®ä»å†…æ ¸ä¼ é€åˆ°ç¡¬ä»¶å’Œä»ç¡¬ä»¶è¯»å–æ•°æ®ã€‚
  ã€€ã€€3. è¯»å–åº”ç”¨ç¨‹åºä¼ é€ç»™è®¾å¤‡æ–‡ä»¶çš„æ•°æ®å’Œå›é€åº”ç”¨ç¨‹åºè¯·æ±‚çš„æ•°æ®ã€‚
  ã€€ã€€4. æ£€æµ‹å’Œå¤„ç†è®¾å¤‡å‡ºç°çš„é”™è¯¯ã€‚
	åœ¨Linuxæ“ä½œç³»ç»Ÿä¸‹æœ‰ä¸‰ç±»ä¸»è¦çš„è®¾å¤‡æ–‡ä»¶ç±»å‹ï¼Œä¸€æ˜¯å­—ç¬¦è®¾å¤‡ï¼ŒäºŒæ˜¯å—è®¾å¤‡ï¼Œä¸‰æ˜¯ç½‘ç»œè®¾å¤‡ã€‚å­—ç¬¦è®¾å¤‡å’Œå—è®¾å¤‡çš„ä¸»è¦åŒºåˆ«æ˜¯:åœ¨å¯¹å­—ç¬¦è®¾å¤‡å‘å‡ºè¯»/å†™è¯·æ±‚æ—¶ï¼Œå®é™…çš„ç¡¬ä»¶I/Oä¸€èˆ¬å°±ç´§æ¥ç€å‘ç”Ÿäº†ï¼Œå—è®¾å¤‡åˆ™ä¸ç„¶ï¼Œå®ƒåˆ©ç”¨ä¸€å—ç³»ç»Ÿå†…å­˜ä½œç¼“å†²åŒºï¼Œå½“ç”¨æˆ·è¿›ç¨‹å¯¹è®¾å¤‡è¯·æ±‚èƒ½æ»¡è¶³ç”¨æˆ·çš„è¦æ±‚ï¼Œå°±è¿”å›è¯·æ±‚çš„æ•°æ®ï¼Œå¦‚æœä¸èƒ½ï¼Œå°±è°ƒç”¨è¯·æ±‚å‡½æ•°æ¥è¿›è¡Œå®é™…çš„I/Oæ“ä½œã€‚å—è®¾å¤‡æ˜¯ä¸»è¦é’ˆå¯¹ç£ç›˜ç­‰æ…¢é€Ÿè®¾å¤‡è®¾è®¡çš„ï¼Œä»¥å…è€—è´¹è¿‡å¤šçš„CPUæ—¶é—´æ¥ç­‰å¾…ã€‚

**1.ç¼–å†™å­—ç¬¦é©±åŠ¨ç¨‹åº,åŠŸèƒ½æ˜¯å‘è™šæ‹Ÿå‡ºçš„è™šæ‹Ÿè®¾å¤‡ä¼ å…¥ä¸€è¿ä¸²çš„æ•°å­—å­—ç¬¦.**
(ä»¥ä¸‹æ˜¯æ¦‚è¦ä»£ç ,è¯¦æƒ…è¯·å‰å¾€GitHubä»“åº“é˜…è§ˆ)
**2.å­—ç¬¦è®¾å¤‡é©±åŠ¨ä»£ç **

```c
#include  <linux/modules.h>   
#include  <linux/version.h>
#include <linux/types.h>   
#include <linux/fs.h>   
#include <linux/mm.h>   
#include <linux/errno.h>   
#include <asm/segment.h>
//ä»¥ä¸Šæ˜¯æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰å¤´æ–‡ä»¶
long int ALEX_MAJOR = 0;
static ssize_t read_alex(struct file *flip,char *buf,size_t count, loff_t*f_pos)
{ 
	int left;   
	for(left = count ; left > 0 ; left--)   
{   
	put_user(9,buf);   
	buf++;   
}   
	return count; 
} //readæ“ä½œå®šä¹‰
static ssize_t write_alex(struct file *flip,const char *file,size_t count, loff_t*f_pos) 
{ 
	return count; 
} //writeæ“ä½œçš„å®šä¹‰
 
static int open_alex(struct inode *inode,struct file *file ) 
{
	
	return 0; 
} //openæ“ä½œçš„å®šä¹‰
 
static int release_alex(struct inode *inode,struct file *file )
{

}//releaseæ“ä½œçš„å®šä¹‰

struct file_operations alex_fops={
	.read = read_alex,
	.write=write_alex,
	.open=open_alex,
	.release=release_alex
};//æ“ä½œé¡ºåºå®šä¹‰

static int init_mymodule(void) 
{ 
	int result;
	result = register_chrdev(0, "alex", &alex_fops); 
	if (result < 0) { 
		printk(KERN_INFO "alex: can't get major number\n"); 
		return result;
	} 
	if (ALEX_MAJOR == 0) ALEX_MAJOR = result; /* dynamic */ 
	return 0; 
}//åˆå§‹åŒ–é©±åŠ¨ç¨‹åº
static void cleanup_mymodule(void) 
{ 
	unregister_chrdev(ALEX_MAJOR,"alex"); 
} //ç»ˆæ­¢é©±åŠ¨ç¨‹åº

MODULE_LICENSE("GPL");
module_init(init_mymodule);
module_exit(cleanup_mymodule);
```

**3.ç¼–è¯‘æ­¥éª¤**
a. å°†ä¸Šè¿°ç¨‹åºå¤åˆ¶åˆ°/usr/src/linux**/drivers/miscä¸‹
b.åœ¨Makefileæ–‡ä»¶ä¸­åŠ å…¥ä¸€å¥

```c
obj-m +=alex_driver.0
```

c.æ‰§è¡Œ

```
make -C /usr/src/linux SUBDIR=$PWD modules
```

å¾—åˆ°.koæ–‡ä»¶
d.æŒ‚è½½

```
insmod ./alex_driver.ko
```

e.æŸ¥çœ‹ç³»ç»Ÿåˆ†é…çš„è®¾å¤‡å·

```
cat /proc/devices
```

å‘ç°å‡ºç°äº†ä¸€ä¸ªè®¾å¤‡å«alex,è®°ä¸‹å®ƒå‰é¢çš„è®¾å¤‡å·,æˆ‘çš„æ˜¯241.

f.åˆ›å»ºæ–°çš„è™šæ‹Ÿè®¾å¤‡æ–‡ä»¶

```
mknod /dev/alex c 241 0
chmod 666 /dev/alex
```

æ‰§è¡Œç»“æŸå,ä¼šåœ¨/devä¸­çœ‹åˆ°ä¸€ä¸ªæ–°çš„è®¾å¤‡æ–‡ä»¶alex

**4.ç¼–å†™æµ‹è¯•ç¨‹åº**

```c
#include <stdio.h>   
#include <sys/types.h>   
#include <sys/stat.h>   
#include <fcntl.h>
#include <stdlib.h>
#include <unistd.h>
int main()   
{   
	int testdev;   
	int i;   
	char buf[10];   
	testdev = open("/dev/alex",O_RDWR);   
	if ( testdev == -1 )   
	{   
		printf("Can't open file \n");   
		exit(0);   
		}   
	read(testdev,buf,10);   
	for (i = 0; i < 10;i++)
	printf("%d\n",buf[i]);  
	close(testdev);   
}  
```

**5.æµ‹è¯•æˆåŠŸåå¸è½½æ¨¡å—**

```
rmmod alex-drive
rm /dev/alex
```

ä»¥ä¸Šæ­¥éª¤ä¸­å¦‚æœæƒé™ä¸å¤Ÿè¯·åœ¨å‘½ä»¤å‰åŠ ä¸Šsudo.

### 4.4ä½¿ç”¨GTK/QTå®ç°ç³»ç»Ÿç›‘æ§å™¨

åŒ4.1ä¸­çš„é¢˜ç›®å…¶å®ååˆ†ç›¸ä¼¼,åªæ˜¯ä¸ç”¨å¼ºåˆ¶è¦æ±‚è®¾è®¡å¹¶å‘è¿›ç¨‹äº†.
ä½†æ˜¯ä¸€å®šè¦åˆ¶ä½œå›¾å½¢ç•Œé¢,è¿™é‡Œæˆ‘ä»¬ä»ç„¶é€‰ç”¨Qt5æ¥åš.
**1.åŠŸèƒ½æ¸…å•ğŸ§¾**

```
- 1.è·å–å¹¶æ˜¾ç¤ºä¸»æœºå
- 2.è·å–å¹¶æ˜¾ç¤ºç³»ç»Ÿå¯åŠ¨çš„æ—¶é—´
- 3.æ˜¾ç¤ºç³»ç»Ÿåˆ°ç›®å‰ä¸ºæ­¢æŒç»­è¿è¡Œçš„æ—¶é—´
- 4.æ˜¾ç¤ºç³»ç»Ÿçš„ç‰ˆæœ¬å·
- 5.æ˜¾ç¤ºCPUçš„å‹å·å’Œä¸»é¢‘å¤§å°
- 6.é€šè¿‡pidæˆ–è€…è¿›ç¨‹åæŸ¥è¯¢ä¸€ä¸ªè¿›ç¨‹,å¹¶æ˜¾ç¤ºè¯¥è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯,æä¾›æ€æ‰è¯¥è¿›ç¨‹çš„åŠŸèƒ½
- 7.æ˜¾ç¤ºç³»ç»Ÿæ‰€æœ‰è¿›ç¨‹çš„ä¸€äº›ä¿¡æ¯,åŒ…æ‹¬pid,ppid,å ç”¨å†…å­˜å¤§å°,ä¼˜å…ˆçº§ç­‰
- 8.cpuä½¿ç”¨ç‡çš„å›¾å½¢åŒ–æ˜¾ç¤º(2åˆ†é’Ÿå†…çš„å†å²è®°å½•æ›²çº¿)
- 9.å†…å­˜å’Œäº¤æ¢åˆ†åŒº(swap)ä½¿ç”¨ç‡çš„å›¾å½¢åŒ–æ˜¾ç¤º(2åˆ†é’Ÿå†…çš„å†å²è®°å½•æ›²çº¿)
- 10.åœ¨çŠ¶æ€æ æ˜¾ç¤ºå½“å‰æ—¶é—´
- 11.åœ¨çŠ¶æ€æ æ˜¾ç¤ºå½“å‰CPUä½¿ç”¨ç‡
- 12.åœ¨çŠ¶æ€æ æ˜¾ç¤ºå½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µ
- 13.ç”¨æ–°è¿›ç¨‹è¿è¡Œä¸€ä¸ªå…¶ä»–ç¨‹åº
- 14.å…³æœºåŠŸèƒ½
```

**2.è®¾è®¡æµç¨‹**
æ•´ä¸ªä»»åŠ¡ç®¡ç†å™¨çš„è®¾è®¡ä¸»è¦åˆ†æˆä¸¤ä¸ªæ­¥éª¤.

- åŠŸèƒ½å‡½æ•°çš„è®¾è®¡
- Qt UIç•Œé¢è®¾è®¡

### 4.5å°å‹æ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿ

1.linuxæ–‡ä»¶ç³»ç»Ÿæ¦‚è¿°
æ–‡ä»¶ç³»ç»ŸæŒ‡æ–‡ä»¶å­˜åœ¨çš„ç‰©ç†ç©ºé—´ï¼Œlinuxç³»ç»Ÿä¸­æ¯ä¸ªåˆ†åŒºéƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œéƒ½æœ‰è‡ªå·±çš„ç›®å½•å±‚æ¬¡ç»“æ„ã€‚linuxä¼šå°†è¿™äº›åˆ†å±ä¸åŒåˆ†åŒºçš„ã€å•ç‹¬çš„æ–‡ä»¶ç³»ç»ŸæŒ‰ä¸€å®šçš„æ–¹å¼å½¢æˆä¸€ä¸ªç³»ç»Ÿçš„æ€»çš„ç›®å½•å±‚æ¬¡ç»“æ„ã€‚ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„è¿è¡Œç¦»ä¸å¼€å¯¹æ–‡ä»¶çš„æ“ä½œï¼Œå› æ­¤å¿…ç„¶è¦æ‹¥æœ‰å¹¶ç»´æŠ¤è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€‚ ã€€ã€€ 
linuxæ–‡ä»¶ç³»ç»Ÿä½¿ç”¨**ç´¢å¼•èŠ‚ç‚¹**æ¥è®°å½•æ–‡ä»¶ä¿¡æ¯ï¼Œä½œç”¨åƒwindowsçš„æ–‡ä»¶åˆ†é…è¡¨ã€‚ç´¢å¼•èŠ‚ç‚¹æ˜¯ä¸€ä¸ªç»“æ„ï¼Œå®ƒåŒ…å«äº†ä¸€ä¸ªæ–‡ä»¶çš„**é•¿åº¦ã€åˆ›å»ºåŠä¿®æ”¹æ—¶é—´ã€æƒé™ã€æ‰€å±å…³ç³»ã€ç£ç›˜ä¸­çš„ä½ç½®**ç­‰ä¿¡æ¯ã€‚ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿç»´æŠ¤äº†ä¸€ä¸ªç´¢å¼•èŠ‚ç‚¹çš„æ•°ç»„ï¼Œæ¯ä¸ªæ–‡ä»¶æˆ–ç›®å½•éƒ½ä¸ç´¢å¼•èŠ‚ç‚¹æ•°ç»„ä¸­çš„å”¯ä¸€ä¸€ä¸ªå…ƒç´ å¯¹åº”ã€‚ç³»ç»Ÿç»™æ¯ä¸ªç´¢å¼•èŠ‚ç‚¹åˆ†é…äº†ä¸€ä¸ªå·ç ï¼Œä¹Ÿå°±æ˜¯è¯¥èŠ‚ç‚¹åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•å·ï¼Œç§°ä¸ºç´¢å¼•èŠ‚ç‚¹å·ã€‚ ã€€ã€€

linuxæ–‡ä»¶ç³»ç»Ÿå°†æ–‡ä»¶ç´¢å¼•èŠ‚ç‚¹å·å’Œæ–‡ä»¶ååŒæ—¶ä¿å­˜åœ¨ç›®å½•ä¸­ã€‚æ‰€ä»¥ï¼Œç›®å½•åªæ˜¯å°†æ–‡ä»¶çš„åç§°å’Œå®ƒçš„ç´¢å¼•èŠ‚ç‚¹å·ç»“åˆåœ¨ä¸€èµ·çš„ä¸€å¼ è¡¨ï¼Œ**ç›®å½•ä¸­æ¯ä¸€å¯¹æ–‡ä»¶åç§°å’Œç´¢å¼•èŠ‚ç‚¹å·ç§°ä¸ºä¸€ä¸ªè¿æ¥**ã€‚ ã€€ã€€
å¯¹äºä¸€ä¸ªæ–‡ä»¶æ¥è¯´æœ‰å”¯ä¸€çš„ç´¢å¼•èŠ‚ç‚¹å·ä¸ä¹‹å¯¹åº”ï¼Œå¯¹äºä¸€ä¸ªç´¢å¼•èŠ‚ç‚¹å·ï¼Œå´å¯ä»¥æœ‰å¤šä¸ªæ–‡ä»¶åä¸ä¹‹å¯¹åº”ã€‚å› æ­¤ï¼Œåœ¨ç£ç›˜ä¸Šçš„åŒä¸€ä¸ªæ–‡ä»¶å¯ä»¥é€šè¿‡ä¸åŒçš„è·¯å¾„å»è®¿é—®å®ƒã€‚å¯ä»¥ç”¨lnå‘½ä»¤å¯¹ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶å†å»ºç«‹ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œè€Œä¸å¤åˆ¶æ–‡ä»¶çš„å†…å®¹ã€‚ ã€€ã€€

è¿æ¥æœ‰è½¯è¿æ¥å’Œç¡¬è¿æ¥ä¹‹åˆ†ï¼Œè½¯è¿æ¥åˆå«ç¬¦å·è¿æ¥ã€‚å®ƒä»¬å„è‡ªçš„ç‰¹ç‚¹æ˜¯ï¼š ã€€ã€€
ç¡¬è¿æ¥ï¼šåŸæ–‡ä»¶åå’Œè¿æ¥æ–‡ä»¶åéƒ½æŒ‡å‘ç›¸åŒçš„ç‰©ç†åœ°å€ã€‚ç›®å½•ä¸èƒ½æœ‰ç¡¬è¿æ¥ï¼›ã€€ã€€
ç¡¬è¿æ¥ä¸èƒ½è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿï¼ˆä¸èƒ½è·¨è¶Šä¸åŒçš„åˆ†åŒºï¼‰æ–‡ä»¶åœ¨ç£ç›˜ä¸­åªæœ‰ä¸€ä¸ªæ‹·è´ï¼ŒèŠ‚çœç¡¬ç›˜ç©ºé—´ï¼›ã€€ã€€
ç”±äºåˆ é™¤æ–‡ä»¶è¦åœ¨åŒä¸€ä¸ªç´¢å¼•èŠ‚ç‚¹å±äºå”¯ä¸€çš„è¿æ¥æ—¶æ‰èƒ½æˆåŠŸï¼Œå› æ­¤å¯ä»¥é˜²æ­¢ä¸å¿…è¦çš„è¯¯åˆ é™¤ã€‚ ã€€ã€€
ç¬¦å·è¿æ¥ï¼šç”¨ln -så‘½ä»¤å»ºç«‹æ–‡ä»¶çš„ç¬¦å·è¿æ¥ç¬¦å·è¿æ¥æ˜¯linuxç‰¹æ®Šæ–‡ä»¶çš„ä¸€ç§ï¼Œä½œä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒçš„æ•°æ®æ˜¯å®ƒæ‰€è¿æ¥çš„æ–‡ä»¶çš„è·¯å¾„åã€‚ç±»ä¼¼windowsä¸‹çš„å¿«æ·æ–¹å¼ã€‚å¯ä»¥åˆ é™¤åŸæœ‰çš„æ–‡ä»¶è€Œä¿å­˜è¿æ¥æ–‡ä»¶ï¼Œæ²¡æœ‰é˜²æ­¢è¯¯åˆ é™¤åŠŸèƒ½.